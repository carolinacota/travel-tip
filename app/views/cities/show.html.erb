<div class='city-banner' style="background-image: url(<%="https://images.unsplash.com/photo-1486299267070-83823f5448dd?ixlib=rb-1.2.1&auto=format&fit=crop&w=1951&q=80"%>)">
  <img src="https://image.freepik.com/free-vector/street-map-with-pin-routes_23-2147622544.jpg" alt="" class="modal-img" data-toggle="modal" data-target="#myModal">
</div>
<div class="container">
  <div class="city-name">
    <h1><%= @city.name %></h1>
    <h3>Discover <%= @city.name.capitalize %>'s TOP tips</h3>
  </div>


  <button type="button" class="btn btn-pink-tags" data-toggle="modal" data-target="#myModal2">Filter</button>
  <%= link_to "Reset", city_path  %>

  <!-- Modal 2 -->
  <div id="myModal2" class="modal fade" role="dialog">
    <div class="modal-dialog">

      <!-- Modal content-->
      <div class="modal-content">

         <div class="col-xs-12 col-sm-12" style="height: 75vh">
          <%= simple_form_for :search, url: city_path, method: "GET" do |f| %>
            <%= f.input :foods, label: "Food & Drinks", required: false,  collection: Place::FOODS, as: :check_boxes %>
            <%= f.input :sights, label: "Sights", required: false,  collection: Place::SIGHTS, as: :check_boxes %>
            <%= f.input :entertainments, label: "Entertainment", required: false,  collection: Place::ENTERTAINMENTS, as: :check_boxes %>
            <%= f.submit "Apply Filter", class: "btn btn-primary" %>
          <% end %>
        </div>

      </div>

    </div>
  </div>


    <% if params["search"] %>
      <% @filter = params["search"]["foods"].concat(params["search"]["sights"]).flatten.reject(&:blank?) %>
        <% @places = @filter.empty? ? @city.places : @city.places.tagged_with(@filter, any: true) %>
          <% else %>
        <% @places = @city.places %>
    <% end %>




  <% @places.each do |place| %>
    <div class="tip-card m-2">
      <img src="https://source.unsplash.com/random/?food" alt="" class="image">
        <div class="text ml-3">
          <div class="d-flex">
            <div class="place-name flex-grow-1">
              <h3><%= place.name %></h3>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
                <i class="fas fa-star"></i>
            </div>
            <div>
              <% if @list.city.nil? %>
                <%= link_to city_lists_path(@city), method: :post do  %>
                  <i class="fas fa-plus"></i>
                <% end %>
              <% else %>
                <%= link_to city_list_path(@city, @list) do %>
                  <i class="fas fa-plus"></i>
                <% end %>
              <% end %>
             </div>
           </div>
           <div class="card-tips">
             <p>Tipper's say:</p>
             <h3>"Great place!"</h3>
           </div>
           <div class="d-flex card-tags">
            <% place.food_list.each do |tag| %>
              <div class="btn-pink-tags">
                <%= tag %>
              </div>
            <% end %>
              <% place.sight_list.each do |tag| %>
              <div class="btn-pink-tags">
                <%= tag %>
              </div>
            <% end %>
              <% place.entertainment_list.each do |tag| %>
              <div class="btn-pink-tags">
                <%= tag %>
              </div>
            <% end %>
           </div>
         </div>

        </div>
    <% end %>
</div>

<!-- Modal -->
<div id="myModal" class="modal fade" role="dialog">
  <div class="modal-dialog modal-xl">

    <!-- Modal content-->
    <div class="modal-content">

     <div
          id="map"
          style="
          height: 75vh;
          overflow: visible;
          margin-left: -0%;
          margin-top: -0%;"
          data-markers="<%= @markers.to_json %>"
          data-mapbox-api-key="<%= ENV['MAPBOX_API_KEY'] %>"
          style="border: 1px solid black"
        ></div>

    </div>

  </div>
</div>


